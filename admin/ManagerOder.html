<!DOCTYPE html>
<html>

<head>
    <title>Quản lý đơn hàng</title>
    <!-- Bootstrap -->
    <meta charset="utf-8">
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <link href="bootstrap/css/bootstrap-responsive.min.css" rel="stylesheet" media="screen">
    <link href="assets/styles.css" rel="stylesheet" media="screen">
    <link href="assets/DT_bootstrap.css" rel="stylesheet" media="screen">
    <!--[if lte IE 8]><script language="javascript" type="text/javascript" src="vendors/flot/excanvas.min.js"></script><![endif]-->
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
    <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <script src="Admin/vendors/modernizr-2.6.2-respond-1.1.0.min.js"></script>
    <script src='https://kit.fontawesome.com/a076d05399.js'></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.22/pdfmake.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/0.4.1/html2canvas.min.js"></script>
    <style>

    </style>
</head>

<body>
    <div class="navbar navbar-fixed-top">
        <div class="navbar-inner">
            <div class="container-fluid">
                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse"> <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>
                <a class="brand" href="#">Admin Truemart</a>
                <div class="nav-collapse collapse">
                    <ul class="nav pull-right">
                        <li class="dropdown">
                            <a href="#" role="button" class="dropdown-toggle" data-toggle="dropdown"> <i class="icon-user"></i>Quang Huy<i class="caret"></i>
                            </a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a tabindex="-1" href="">Thông tin cá nhân</a>
                                </li>
                                <li class="divider"></li>
                                <li>
                                    <a tabindex="-1" href="">Đăng xuất</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>
                </c:if>
                <!--/.nav-collapse -->
            </div>
        </div>
    </div>
    <div class="span3" id="sidebar">
        <ul class="nav nav-list bs-docs-sidenav nav-collapse collapse">
            <li>
                <a href="http://localhost:8080/project_BookStore/Home"><i class="icon-chevron-right"></i> Trang chủ</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/Admin/index.jsp"><i class="icon-chevron-right"></i> Thông tin chung</a>
            </li>
            <li>
                <a href="calendar.html"><i class="icon-chevron-right"></i> Lịch</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/Admin/stats.jsp"><i class="icon-chevron-right"></i> Thống kê</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/ListUserAd"><i class="icon-chevron-right"></i> Quản lý thành viên</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/ListProductAd"><i class="icon-chevron-right"></i> Quản lý sản phẩm</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/ListOrderAd"><i class="icon-chevron-right"></i> Quản lý đơn hàng</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/ListContactAd"><i class="icon-chevron-right"></i> Quản lý liên hệ</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/Admin/buttons.jsp"><i class="icon-chevron-right"></i> Buttons & Icons</a>
            </li>
            <li>
                <a href="http://localhost:8080/project_BookStore/Admin/interface.jsp"><i class="icon-chevron-right"></i> UI & Interface</a>
            </li>
            <li>
                <a href="#"><span class="badge badge-success pull-right"></span> Đơn đặt hàng</a>
            </li>
            <li>
                <a href="#"><span class="badge badge-info pull-right"></span> Users</a>
            </li>
            <li>
                <a href="#"><span class="badge badge-info pull-right"></span> Liên hệ</a>
            </li>
            <li>
                <a href="#"><span class="badge badge-info pull-right"></span> Sản phẩm</a>
            </li>
        </ul>
    </div>
    <div class="container-fluid">
        <div class="row-fluid">
            <jsp:include page="menu.jsp" />
            <!--/span-->
            <div class="span9" id="content">
                <div class="row-fluid">
                    <!-- block -->
                    <div class="block">
                        <div class="navbar navbar-inner block-header">
                            <div class="muted pull-left">Quản lý đơn hàng</div>
                        </div>
                        <div class="block-content collapse in">
                            <div class="span12">
                                <div class="table-toolbar">
                                    <div class="btn-group" style="visibility: hidden">
                                        <a href="#"><button class="btn btn-success"><i class="icon-plus icon-white"></i></button></a>
                                    </div>
                                    <div class="btn-group pull-right">
                                        <button data-toggle="dropdown" class="btn dropdown-toggle">Công cụ <span class="caret"></span></button>
                                        <ul class="dropdown-menu">
                                            <li><a href="#">In</a></li>
                                            <li><a id="exportPDF">Lưu file PDF</a></li>
                                            <li><a onclick="exportTableToExcel('example2','orders')">Xuất ra Excel</a></li>
                                        </ul>
                                    </div>
                                </div>
                                <table cellpadding="0" cellspacing="0" border="0" class="table table-bordered" id="example2">
                                    <thead>
                                        <tr>
                                            <th>Mã đơn hàng</th>
                                            <th>Tên khách hàng</th>
                                            <th>Ngày đặt</th>
                                            <th>Trạng thái</th>
                                            <th></th>
                                            <th></th>
                                            <th></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <c:forEach items="${listOrders}" var="order">
                                            <tr id="${order.orderID}">
                                                <td>${order.orderID}</td>
                                                <td>${order.fullName}</td>
                                                <td>${order.createDate}</td>
                                                <td id="orderstatus">
                                                    <c:if test="${order.status eq '1'}">Đã xử lý</c:if>
                                                    <c:if test="${order.status eq '0'}">Chưa xử lý</c:if>
                                                </td>
                                                <td id="rowupdate">
                                                    <c:if test="${order.status eq '1'}"></c:if>
                                                    <c:if test="${order.status eq '0'}">
                                                        <a id="linkupdate" href="${order.orderID}" onclick="return false;">
                                                            <span class="fas fa-shipping-fast"></span> Xử lý</a>
                                                    </c:if>
                                                </td>
                                                <td>
                                                    <a href="ListOrderDetailAd?id=${order.orderID}&fullName=${order.fullName}&address=${order.address}&phone=${order.phone}&createDate=${order.createDate}&tax=${order.tax}&ship=${order.ship}&total=${order.totalPrice}">
                                                        <span class="fas fa-address-book"></span> Xem chi tiết</a>
                                                </td>
                                                <td><a class="text-danger" href="${order.orderID}" onclick="return false;"><span class="far fa-window-close"></span> Xóa</a></td>
                                            </tr>
                                        </c:forEach>
                                    </tbody>
                                </table>
                                <div id="id01" class="modal">
                                    <!-- Modal Content -->
                                    <form class="modal-content animate">
                                        <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
                                        <div class="header-modal">
                                            <h3>Bạn có chắc là muốn xóa đơn hàng này</h3>
                                        </div>
                                        <input id="delete" name="action" style="display: none" value="delete">
                                        <input id="deleteval" name="id" style="display: none">
                                        <div class="button-group">
                                            <button id="btnDelete" class="btn-yes" type="button" onclick="document.getElementById('id01').style.display='none'">Có</button>
                                            <button class="btn-no" type="button" onclick="document.getElementById('id01').style.display='none'">Không</button>
                                        </div>
                                    </form>
                                </div>
                                <div id="id02" class="modal">
                                    <!-- Modal Content -->
                                    <form class="modal-content animate">
                                        <span onclick="document.getElementById('id01').style.display='none'" class="close" title="Close Modal">&times;</span>
                                        <div class="header-modal">
                                            <h3>Bạn có chắc là muốn xử lý đơn hàng này</h3>
                                        </div>
                                        <input id="delete" name="action" style="display: none" value="delete">
                                        <input id="updateval" name="id" style="display: none">
                                        <div class="button-group">
                                            <button id="btnUpdate" class="btn-yes" type="button" onclick="document.getElementById('id02').style.display='none'">Có</button>
                                            <button class="btn-no" type="button" onclick="document.getElementById('id02').style.display='none'">Không</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- /block -->
                </div>
            </div>
        </div>
        <hr>
        <jsp:include page="footer.jsp" />
    </div>
    <!--/.fluid-container-->

    <script src="Admin/vendors/jquery-1.9.1.js"></script>
    <script src="Admin/bootstrap/js/bootstrap.min.js"></script>
    <script src="Admin/vendors/datatables/js/jquery.dataTables.min.js"></script>


    <script src="Admin/assets/scripts.js"></script>
    <script src="Admin/assets/DT_bootstrap.js"></script>
    <script>
        // $(document).ready( function () {
        //     $('#example2').DataTable();
        // } );
    </script>
    <script>
        // Get the modal
        var modal = document.getElementById('id01');

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
                if (event.target == modal) {
                    modal.style.display = "none";
                }
            }
            // // Get the modal
        var modal2 = document.getElementById('id02');

        // When the user clicks anywhere outside of the modal, close it
        window.onclick = function(event) {
            if (event.target == modal2) {
                modal2.style.display = "none";
            }
        }
    </script>
    <script>
        $(document).ready(function() {
            $(".text-danger").click(function() {
                var href = $(this).attr("href")
                $("#deleteval").attr("value", href)
                document.getElementById('id01').style.display = 'block'
            });
            $("#linkupdate").click(function() {
                var href = $(this).attr("href")
                $("#updateval").attr("value", href)
                document.getElementById('id02').style.display = 'block'
            });
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#btnDelete").click(function() {
                var id = $("#deleteval").attr("value");
                $.ajax({
                    type: "GET",
                    data: {
                        action: "delete",
                        id: id
                    },
                    url: "/project_BookStore/ListOrderAd"
                })
                $("#" + id).remove();
            });
            $("#btnUpdate").click(function() {
                var id = $("#updateval").attr("value");
                $.ajax({
                    type: "GET",
                    data: {
                        action: "update",
                        id: id
                    },
                    url: "/project_BookStore/ListOrderAd"
                })
                $("#" + id).children("#rowupdate").children().remove();
                $("#" + id).children("#orderstatus").text("Đã xử lý");
            });
        })
    </script>
    <script type="text/javascript">
        $("body").on("click", "#exportPDF", function() {
            html2canvas($('#example2')[0], {
                onrendered: function(canvas) {
                    var data = canvas.toDataURL();
                    var docDefinition = {
                        content: [{
                            image: data,
                            width: 500
                        }]
                    };
                    pdfMake.createPdf(docDefinition).download("Order.pdf");
                }
            });
        });
    </script>
    <script>
        function exportTableToExcel(tableID, filename = '') {
            var downloadLink;
            var dataType = 'application/vnd.ms-excel';
            var tableSelect = document.getElementById(tableID);
            var tableHTML = tableSelect.outerHTML.replace(/ /g, '%20');

            // Specify file name
            filename = filename ? filename + '.xls' : 'excel_data.xls';

            // Create download link element
            downloadLink = document.createElement("a");

            document.body.appendChild(downloadLink);

            if (navigator.msSaveOrOpenBlob) {
                var blob = new Blob(['\ufeff', tableHTML], {
                    type: dataType
                });
                navigator.msSaveOrOpenBlob(blob, filename);
            } else {
                // Create a link to the file
                downloadLink.href = 'data:' + dataType + ', ' + tableHTML;

                // Setting the file name
                downloadLink.download = filename;

                //triggering the function
                downloadLink.click();
            }
        }
    </script>
</body>

</html>